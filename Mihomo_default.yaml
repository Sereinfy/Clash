  # 锚点引用
rule-anchor:
  # 测速地址
  TestUrl: &TestUrl {url: "https://www.apple.com/library/test/success.html", expected-status: 200/302, timeout: 3000, interval: 100}
  # 自动测速
  AutoAll: &AutoAll {type: url-test, include-all: true, lazy: true, timeout: 3000, max-failed-times: 1, tolerance: 50, <<: *TestUrl}
  # 更新时间
  Check: &Check {type: http, interval: 600, health-check: {enable: true, <<: *TestUrl}}
  # 远程参数
  Classical: &classic {type: http, interval: 86400, behavior: classical}
  ipcidr: &ip {type: http, interval: 86400, behavior: ipcidr}
  domain: &domain {type: http, interval: 86400, behavior: domain}
  # 节点过滤
  Exclude: &Exclude {exclude-filter: 奈飞|推荐|过期|剩余|到期|官网|失联|回国|群|长期|重置|余额|充值|氪金|套餐|限制}
  Hy2: &Hy2 {exclude-type: hysteria2}
  # 地区过滤
  filterHK: &filterHK {<<: *AutoAll, hidden: false, filter: "(?i)(?!直连)(香港|🇭🇰|hk|hongkong|hong kong|HKG)"}
  filterTW: &filterTW {<<: *AutoAll, hidden: false, filter: "(?i)(?!直连)(台湾|🇼🇸|🇹🇼|TW|taiwan|TPE|TSA|KHH)"}
  filterJP: &filterJP {<<: *AutoAll, hidden: false, filter: "(?i)(?!直连)(日本|东京|🇯🇵|JP|Japan|NRT|HND|KIX|CTS|FUK)"}
  filterUS: &filterUS {<<: *AutoAll, hidden: false, filter: "(?i)(?!直连)(美国|🇺🇸|洛杉矶|圣何塞|纽约|凤凰城|us|unitedstates|united states)"}
  filterSG: &filterSG {<<: *AutoAll, hidden: false, filter: "(?i)(?!直连)(新加坡|🇸🇬|sg|singapore)"}
  filterNL: &filterNL {<<: *AutoAll, hidden: true, filter: "(?i)(?!直连)(荷兰|🇳🇱|nl|Netherlands)"}
  filterLow: &filterLow {<<: *AutoAll, hidden: true, filter: "(?i)(?!直连)(0.[1-8])"}
  filterJP_HK: &filterJP_HK {<<: *AutoAll, hidden: false, filter: "(?i)(?!直连)(日本|东京|🇯🇵|JP|Japan|NRT|HND|KIX|CTS|FUK|香港|🇭🇰|hk|hongkong|hong kong|HKG)"}
  filterJP_HK_SG: &filterJP_HK_SG {<<: *AutoAll, hidden: false, filter: "(?i)(?!直连)(日本|东京|🇯🇵|JP|Japan|NRT|HND|KIX|CTS|FUK|香港|🇭🇰|hk|hongkong|hong kong|HKG|新加坡|🇸🇬|sg|singapore)"}
  # 分组
  Group_vps: &Group_vps {type: select, <<: *TestUrl, use: [Build], include-all-proxies: true, proxies: [DIRECT,Airport]}
  Group_Github: &Group_Github {type: select, <<: *TestUrl, use: [Build], include-all-proxies: true, proxies: [国际互联,AutoUS,DIRECT]}
  
  Group_City: &Group_City {type: select, <<: *TestUrl, include-all-providers: true, proxies: [AutoHK,AutoTW,AutoJP,AutoSG,AutoUS]}
  Group_All: &Group_All {type: select, <<: *TestUrl, proxies: [国际互联,AutoHK,AutoTW,AutoJP,AutoSG,AutoUS,AutoLow,DIRECT]}
  Group_CDN: &Group_CDN {type: select, <<: *TestUrl, proxies: [DIRECT,国际互联,AutoHK,AutoTW,AutoJP,AutoSG,AutoUS,AutoLow]}
  TG_EU_PASS: &TG_EU_PASS {type: select, <<: *TestUrl, proxies: [国际互联,Airport,AutoNL,AutoUS]}
  # 特殊
  Group_Static: &Group_Static {type: smart, policy-priority: "日本:1.1", uselightgbm: true, collectdata: false, include-all-providers: true, <<: *filterJP_HK}
  Group_Mickey: &Group_Mickey {type: smart, policy-priority: "香港:1.0", uselightgbm: true, collectdata: false, include-all-providers: true, <<: *filterJP_HK_SG}

  Group_Static_LB: &Group_Static_LB {type: load-balance, strategy: consistent-hashing, include-all-providers: true, <<: *filterJP_HK}
  Group_Mickey_LB: &Group_Mickey_LB {type: load-balance, strategy: round-robin, include-all-providers: true, <<: *filterJP_HK_SG}
 
proxy-groups:
  - {name: 国际互联, <<: *Group_vps, icon: https://g.blfrp.cn/https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Proxy.png}
  - {name: Airport, <<: *Group_City, icon: https://g.blfrp.cn/https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Airport.png}
  - {name: Twitter, <<: *Group_All, icon: https://g.blfrp.cn/https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Twitter.png}
  #- {name: TG_EU, <<: *TG_EU_PASS, icon: https://g.blfrp.cn/https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Telegram_X.png}
  - {name: Google, <<: *Group_All, icon: https://g.blfrp.cn/https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Google_Search.png}
  - {name: YouTube, <<: *Group_All, icon: https://g.blfrp.cn/https://raw.githubusercontent.com/Sereinfy/Clash/main/icons/YouTube2.png}
  - {name: AI Chat, <<: *Group_All, icon: https://g.blfrp.cn/https://raw.githubusercontent.com/shindgewongxj/WHATSINStash/main/icon/anthropic.png}
  - {name: Telegram, <<: *Group_All, icon: https://g.blfrp.cn/https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Telegram.png}
  - {name: Pikpak, <<: *Group_All, icon: https://g.blfrp.cn/https://raw.githubusercontent.com/fmz200/wool_scripts/main/icons/softlyx/PikPak.png}
  
  - {name: GitHub, <<: *Group_Github, icon: https://g.blfrp.cn/https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/GitHub.png}
  - {name: 静态 CDN, <<: *Group_Static, icon: https://g.blfrp.cn/https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Global.png}
  - {name: Mickey, <<: *Group_Mickey, icon: https://g.blfrp.cn/https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Mickey.png}

  - {name: Cloudflare 官网,<<: *Group_All, icon: https://g.blfrp.cn/https://raw.githubusercontent.com/Sereinfy/Clash/main/icons/1111.png}
  - {name: Cloudflare CDN,<<: *Group_All, icon: https://g.blfrp.cn/https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Cloudflare.png}
  - {name: AWS CDN,<<: *Group_CDN, icon: https://g.blfrp.cn/https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Amazon.png}
  - {name: Akamai CDN, <<: *Group_CDN, icon: https://g.blfrp.cn/https://raw.githubusercontent.com/Sereinfy/Clash/main/icons/akamai.png}
  - {name: Fastly CDN, <<: *Group_CDN, icon: https://g.blfrp.cn/https://raw.githubusercontent.com/Sereinfy/Clash/main/icons/fastly3.png}
  - {name: 广告拦截, type: select, proxies: [REJECT,DIRECT], icon: https://g.blfrp.cn/https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Reject.png}
  - {name: 国内直连, type: select, proxies: [DIRECT,国际互联], icon: https://g.blfrp.cn/https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/CN.png}
  - {name: Apple 国际服务, type: select, proxies: [DIRECT,国际互联], icon: https://g.blfrp.cn/https://raw.githubusercontent.com/shindgewongxj/WHATSINStash/main/icon/apple.png}
  - {name: 漏网之鱼, <<: *Group_All, icon: https://g.blfrp.cn/https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Final.png }

  #分隔,下面是地区分组
  - {name: AutoHK, <<: *filterHK, icon: https://g.blfrp.cn/https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Hong_Kong.png}
  - {name: AutoTW, <<: *filterTW, icon: https://g.blfrp.cn/https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Taiwan.png}
  - {name: AutoJP, <<: *filterJP, icon: https://g.blfrp.cn/https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Japan.png}
  - {name: AutoUS, <<: *filterUS, icon: https://g.blfrp.cn/https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/United_States.png}
  - {name: AutoSG, <<: *filterSG, tolerance: 10, icon: https://g.blfrp.cn/https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Singapore.png}
  - {name: AutoNL, <<: *filterNL, icon: https://flagcdn.com/w160/nl.png}
  - {name: AutoLow, <<: *filterLow, icon: https://g.blfrp.cn/https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Area.png}
rules:
  - SUB-RULE,(OR,((NETWORK,UDP),(NETWORK,TCP))),SUB-DOMAIN
  - RULE-SET,Ads,广告拦截
  - RULE-SET,PCDN,REJECT
  - RULE-SET,LAN,DIRECT
  - RULE-SET,Applications,DIRECT
  - RULE-SET,Tracker,DIRECT
  - RULE-SET,Apple_cn,国内直连 # 云上贵州
  - RULE-SET,Apple_cdn,国内直连 # felixonmars/dnsmasq-china-list
  - RULE-SET,Apple,Apple 国际服务 # NoChina
  - RULE-SET,Microsoft,国内直连
  - RULE-SET,China,国内直连
  - RULE-SET,Pikpak,Pikpak
  - RULE-SET,GitHub,GitHub
  - RULE-SET,Google,Google
  - RULE-SET,Google_cn,Google
  - RULE-SET,YouTube,YouTube
  - RULE-SET,Twitter,Twitter
  - RULE-SET,AI,AI Chat
  - RULE-SET,Cdn_domainset,静态 CDN # 放在重要账户下面，防止鉴权导致的风控
  - RULE-SET,Cdn_non_ip,静态 CDN
  - RULE-SET,Telegram,Telegram,no-resolve
  - RULE-SET,NSFW,Mickey
  - RULE-SET,GFW,国际互联 # 先用 GFW列表 过滤一遍下面的 CDN
  - RULE-SET,Cloudflare,Cloudflare 官网
  ### 下面发起 DNS
  - RULE-SET,Cloudflare_ip,Cloudflare CDN
  - RULE-SET,CloudFront_ip,AWS CDN
  - RULE-SET,Akamai_ip,Akamai CDN
  - RULE-SET,fastly_ip,Fastly CDN
  
  - RULE-SET,China_ip,国内直连
  ###
  - RULE-SET,Global,国际互联 # 漏网之鱼走代理可以去掉
  - MATCH,漏网之鱼

sub-rules:
  SUB-DOMAIN:
    - AND,((NETWORK,UDP),(DST-PORT,443),(RULE-SET,YouTube)),REJECT-DROP # 屏蔽YouTube quic
    - AND,((NETWORK,UDP),(DOMAIN-REGEX,(?i)stun|turn)),REJECT-DROP # WebRTC传输
    - AND,((DOMAIN-KEYWORD,bili),(DOMAIN-REGEX,(?i)pcdn|mcdn)),REJECT
    - AND,((DOMAIN-KEYWORD,jav),(NOT,((DOMAIN-KEYWORD,java)))),国际互联
    - OR,((DOMAIN-SUFFIX,akamai.net),(DOMAIN-SUFFIX,akamaized.net)),Akamai CDN
    - OR,((DOMAIN-KEYWORD,fuliba),(DOMAIN-KEYWORD,wnflb)),国际互联
    - OR,((DOMAIN-KEYWORD,zgocloud),(DOMAIN-KEYWORD,zgovps)),国内直连
    - DOMAIN-KEYWORD,porn,国际互联
    - DOMAIN-KEYWORD,fc2,国际互联
    - DOMAIN,mcs.zijieapi.com,DIRECT # 日志上报，请求风暴
    - DOMAIN-SUFFIX,imagestwist.com,国际互联
    - DOMAIN-SUFFIX,geo2.adobe.com,REJECT-DROP
    - DOMAIN-SUFFIX,in.applicationinsights.azure.com,REJECT-DROP
    - DOMAIN-SUFFIX,pc528.net,国内直连
    - DOMAIN-SUFFIX,liangxin.xyz,国际互联
    - DOMAIN-SUFFIX,gitbook.io,国际互联
    - DOMAIN-SUFFIX,51cg1.com,国际互联
    - DOMAIN-SUFFIX,355.fun,国际互联
    - DOMAIN-SUFFIX,cloudflare-dns.com,国际互联
    - DOMAIN-SUFFIX,tgstat.com,国际互联
    - DOMAIN,dns.cloudflare.com,国际互联
    - DOMAIN-SUFFIX,cloudflare-gateway.com,国内直连
    - DOMAIN-SUFFIX,ipchaxun.net,DIRECT   # ip138
    
    
rule-providers: # https://clash.wiki/premium/rule-providers.html

  China: {<<: *classic, url: https://g.blfrp.cn/https://raw.githubusercontent.com/LM-Firefly/Rules/master/Clash-RuleSet-Classical/Domestic.yaml}
  China_ip: {<<: *ip, format: text, url: https://g.blfrp.cn/https://raw.githubusercontent.com/Sereinfy/Clash/main/rules/china_ip.txt}
  Apple: {<<: *classic, url: https://g.blfrp.cn/https://raw.githubusercontent.com/LM-Firefly/Rules/master/Clash-RuleSet-Classical/Apple.yaml}
  Apple_cn: {<<: *classic, format: text, url: https://ruleset.skk.moe/Clash/non_ip/apple_cn.txt}
  Apple_cdn: {<<: *domain, url: https://g.blfrp.cn/https://raw.githubusercontent.com/Loyalsoldier/clash-rules/release/apple.txt}
  Microsoft: {<<: *classic, url: https://g.blfrp.cn/https://raw.githubusercontent.com/LM-Firefly/Rules/master/Clash-RuleSet-Classical/Microsoft.yaml}
  LAN: {<<: *classic, url: https://g.blfrp.cn/https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Lan/Lan_No_Resolve.yaml}
  
  Google_cn: {<<: *domain, url: https://g.blfrp.cn/https://raw.githubusercontent.com/DustinWin/ruleset_geodata/mihomo-ruleset/google-cn.yaml}
  
  Applications: {<<: *classic, url: https://g.blfrp.cn/https://raw.githubusercontent.com/DustinWin/ruleset_geodata/mihomo-ruleset/applications.yaml}

  YouTube: {<<: *domain, url: https://g.blfrp.cn/https://raw.githubusercontent.com/DustinWin/ruleset_geodata/mihomo-ruleset/youtube.yaml}
  Google: {<<: *classic, url: https://g.blfrp.cn/https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Google/Google_No_Resolve.yaml}
  GitHub: {<<: *classic, url: https://g.blfrp.cn/https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/GitHub/GitHub_No_Resolve.yaml}
  Twitter: {<<: *classic, url: https://g.blfrp.cn/https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Twitter/Twitter_No_Resolve.yaml}
  Pikpak: {<<: *classic, url: https://g.blfrp.cn/https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/PikPak/PikPak_No_Resolve.yaml}
  Cloudflare: {<<: *classic, url: https://g.blfrp.cn/https://raw.githubusercontent.com/LM-Firefly/Rules/master/Clash-RuleSet-Classical/PROXY/Cloudflare.yaml}
  AI: {<<: *domain, url: https://g.blfrp.cn/https://raw.githubusercontent.com/DustinWin/ruleset_geodata/mihomo-ruleset/ai.yaml}
  Telegram: {<<: *ip, url: https://g.blfrp.cn/https://raw.githubusercontent.com/Loyalsoldier/clash-rules/release/telegramcidr.txt}
  
  NSFW: {<<: *domain, url: https://g.blfrp.cn/https://raw.githubusercontent.com/Sereinfy/Clash/main/rules/oisd_nsfw_small.yaml}
  GFW: {<<: *domain, url: https://g.blfrp.cn/https://raw.githubusercontent.com/Loyalsoldier/clash-rules/release/gfw.txt}
  Global: {<<: *domain, url: https://g.blfrp.cn/https://raw.githubusercontent.com/DustinWin/ruleset_geodata/mihomo-ruleset/proxy.yaml}

  Ads: {<<: *domain, url: https://g.blfrp.cn/https://raw.githubusercontent.com/Sereinfy/Adrules/main/rules/adblockmihomolite.yaml}
  Tracker: {<<: *classic, url: https://g.blfrp.cn/https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/PrivateTracker/PrivateTracker_No_Resolve.yaml}
  fakeip-filter: {<<: *domain, url: https://g.blfrp.cn/https://raw.githubusercontent.com/DustinWin/ruleset_geodata/mihomo-ruleset/fakeip-filter.yaml}
  PCDN: {<<: *classic, format: text, url: https://g.blfrp.cn/https://raw.githubusercontent.com/uselibrary/PCDN/main/pcdn.list}
  Cdn_domainset: {<<: *domain, format: text, url: https://ruleset.skk.moe/Clash/domainset/cdn.txt}
  Cdn_non_ip: {<<: *classic, format: text, url: https://ruleset.skk.moe/Clash/non_ip/cdn.txt}
  Cloudflare_ip: {<<: *ip, format: text, url: https://g.blfrp.cn/https://raw.githubusercontent.com/sbwml/luci-app-mosdns/v5/luci-app-mosdns/root/etc/mosdns/rule/cloudflare-cidr.txt}
  CloudFront_ip: {<<: *ip, format: text, url: https://g.blfrp.cn/https://raw.githubusercontent.com/Sereinfy/ipranges/main/amazon/cloudfront_ips.txt}
  Akamai_ip: {<<: *ip, format: text, url: https://g.blfrp.cn/https://raw.githubusercontent.com/Sereinfy/ipranges/main/akamai/ipv4_merged.txt}
  fastly_ip: {<<: *ip, url: https://g.blfrp.cn/https://raw.githubusercontent.com/Loyalsoldier/geoip/release/clash/ipcidr/fastly.txt}
