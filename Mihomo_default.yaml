  # é”šç‚¹å¼•ç”¨
rule-anchor:
  # æµ‹é€Ÿåœ°å€
  TestUrl: &TestUrl {url: "https://www.apple.com/library/test/success.html", expected-status: 200/302, timeout: 3000, interval: 100}
  # è‡ªåŠ¨æµ‹é€Ÿ
  AutoAll: &AutoAll {type: url-test, include-all: true, lazy: true, timeout: 3000, max-failed-times: 1, tolerance: 50, <<: *TestUrl}
  # æ›´æ–°æ—¶é—´
  Check: &Check {type: http, interval: 600, health-check: {enable: true, <<: *TestUrl}}
  # è¿œç¨‹å‚æ•°
  Classical: &classic {type: http, interval: 86400, behavior: classical}
  ipcidr: &ip {type: http, interval: 86400, behavior: ipcidr}
  domain: &domain {type: http, interval: 86400, behavior: domain}
  # èŠ‚ç‚¹è¿‡æ»¤
  Exclude: &Exclude {exclude-filter: å¥ˆé£|æ¨è|è¿‡æœŸ|å‰©ä½™|åˆ°æœŸ|å®˜ç½‘|å¤±è”|å›å›½|ç¾¤|é•¿æœŸ|é‡ç½®|ä½™é¢|å……å€¼|æ°ªé‡‘|å¥—é¤|é™åˆ¶}
  Hy2: &Hy2 {exclude-type: hysteria2}
  # åœ°åŒºè¿‡æ»¤
  filterHK: &filterHK {<<: *AutoAll, hidden: false, filter: "(?i)(?!ç›´è¿)(é¦™æ¸¯|ğŸ‡­ğŸ‡°|hk|hongkong|hong kong|HKG)"}
  filterTW: &filterTW {<<: *AutoAll, hidden: false, filter: "(?i)(?!ç›´è¿)(å°æ¹¾|ğŸ‡¼ğŸ‡¸|ğŸ‡¹ğŸ‡¼|TW|taiwan|TPE|TSA|KHH)"}
  filterJP: &filterJP {<<: *AutoAll, hidden: false, filter: "(?i)(?!ç›´è¿)(æ—¥æœ¬|ä¸œäº¬|ğŸ‡¯ğŸ‡µ|JP|Japan|NRT|HND|KIX|CTS|FUK)"}
  filterUS: &filterUS {<<: *AutoAll, hidden: false, filter: "(?i)(?!ç›´è¿)(ç¾å›½|ğŸ‡ºğŸ‡¸|æ´›æ‰çŸ¶|åœ£ä½•å¡|çº½çº¦|å‡¤å‡°åŸ|us|unitedstates|united states)"}
  filterSG: &filterSG {<<: *AutoAll, hidden: false, filter: "(?i)(?!ç›´è¿)(æ–°åŠ å¡|ğŸ‡¸ğŸ‡¬|sg|singapore)"}
  filterNL: &filterNL {<<: *AutoAll, hidden: true, filter: "(?i)(?!ç›´è¿)(è·å…°|ğŸ‡³ğŸ‡±|nl|Netherlands)"}
  filterLow: &filterLow {<<: *AutoAll, hidden: true, filter: "(?i)(?!ç›´è¿)(0.[1-8])"}
  filterJP_HK: &filterJP_HK {<<: *AutoAll, hidden: false, filter: "(?i)(?!ç›´è¿)(æ—¥æœ¬|ä¸œäº¬|ğŸ‡¯ğŸ‡µ|JP|Japan|NRT|HND|KIX|CTS|FUK|é¦™æ¸¯|ğŸ‡­ğŸ‡°|hk|hongkong|hong kong|HKG)"}
  filterJP_HK_SG: &filterJP_HK_SG {<<: *AutoAll, hidden: false, filter: "(?i)(?!ç›´è¿)(æ—¥æœ¬|ä¸œäº¬|ğŸ‡¯ğŸ‡µ|JP|Japan|NRT|HND|KIX|CTS|FUK|é¦™æ¸¯|ğŸ‡­ğŸ‡°|hk|hongkong|hong kong|HKG|æ–°åŠ å¡|ğŸ‡¸ğŸ‡¬|sg|singapore)"}
  # åˆ†ç»„
  Group_vps: &Group_vps {type: select, <<: *TestUrl, use: [Build], include-all-proxies: true, proxies: [DIRECT,Airport]}
  Group_Github: &Group_Github {type: select, <<: *TestUrl, use: [Build], include-all-proxies: true, proxies: [å›½é™…äº’è”,AutoUS,DIRECT]}
  
  Group_City: &Group_City {type: select, <<: *TestUrl, include-all-providers: true, proxies: [AutoHK,AutoTW,AutoJP,AutoSG,AutoUS]}
  Group_All: &Group_All {type: select, <<: *TestUrl, proxies: [å›½é™…äº’è”,AutoHK,AutoTW,AutoJP,AutoSG,AutoUS,AutoLow,DIRECT]}
  Group_CDN: &Group_CDN {type: select, <<: *TestUrl, proxies: [DIRECT,å›½é™…äº’è”,AutoHK,AutoTW,AutoJP,AutoSG,AutoUS,AutoLow]}
  TG_EU_PASS: &TG_EU_PASS {type: select, <<: *TestUrl, proxies: [å›½é™…äº’è”,Airport,AutoNL,AutoUS]}
  # ç‰¹æ®Š
  Group_Static: &Group_Static {type: smart, policy-priority: "æ—¥æœ¬:1.1", uselightgbm: true, collectdata: false, include-all-providers: true, <<: *filterJP_HK}
  Group_Mickey: &Group_Mickey {type: smart, policy-priority: "é¦™æ¸¯:1.0", uselightgbm: true, collectdata: false, include-all-providers: true, <<: *filterJP_HK_SG}

  Group_Static_LB: &Group_Static_LB {type: load-balance, strategy: consistent-hashing, include-all-providers: true, <<: *filterJP_HK}
  Group_Mickey_LB: &Group_Mickey_LB {type: load-balance, strategy: round-robin, include-all-providers: true, <<: *filterJP_HK_SG}
 
proxy-groups:
  - {name: å›½é™…äº’è”, <<: *Group_vps, icon: https://g.blfrp.cn/https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Proxy.png}
  - {name: Airport, <<: *Group_City, icon: https://g.blfrp.cn/https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Airport.png}
  - {name: Twitter, <<: *Group_All, icon: https://g.blfrp.cn/https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Twitter.png}
  #- {name: TG_EU, <<: *TG_EU_PASS, icon: https://g.blfrp.cn/https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Telegram_X.png}
  - {name: Google, <<: *Group_All, icon: https://g.blfrp.cn/https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Google_Search.png}
  - {name: YouTube, <<: *Group_All, icon: https://g.blfrp.cn/https://raw.githubusercontent.com/Sereinfy/Clash/main/icons/YouTube2.png}
  - {name: AI Chat, <<: *Group_All, icon: https://g.blfrp.cn/https://raw.githubusercontent.com/shindgewongxj/WHATSINStash/main/icon/anthropic.png}
  - {name: Telegram, <<: *Group_All, icon: https://g.blfrp.cn/https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Telegram.png}
  - {name: Pikpak, <<: *Group_All, icon: https://g.blfrp.cn/https://raw.githubusercontent.com/fmz200/wool_scripts/main/icons/softlyx/PikPak.png}
  
  - {name: GitHub, <<: *Group_Github, icon: https://g.blfrp.cn/https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/GitHub.png}
  - {name: é™æ€ CDN, <<: *Group_Static, icon: https://g.blfrp.cn/https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Global.png}
  - {name: Mickey, <<: *Group_Mickey, icon: https://g.blfrp.cn/https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Mickey.png}

  - {name: Cloudflare å®˜ç½‘,<<: *Group_All, icon: https://g.blfrp.cn/https://raw.githubusercontent.com/Sereinfy/Clash/main/icons/1111.png}
  - {name: Cloudflare CDN,<<: *Group_All, icon: https://g.blfrp.cn/https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Cloudflare.png}
  - {name: AWS CDN,<<: *Group_CDN, icon: https://g.blfrp.cn/https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Amazon.png}
  - {name: Akamai CDN, <<: *Group_CDN, icon: https://g.blfrp.cn/https://raw.githubusercontent.com/Sereinfy/Clash/main/icons/akamai.png}
  - {name: Fastly CDN, <<: *Group_CDN, icon: https://g.blfrp.cn/https://raw.githubusercontent.com/Sereinfy/Clash/main/icons/fastly3.png}
  - {name: å¹¿å‘Šæ‹¦æˆª, type: select, proxies: [REJECT,DIRECT], icon: https://g.blfrp.cn/https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Reject.png}
  - {name: å›½å†…ç›´è¿, type: select, proxies: [DIRECT,å›½é™…äº’è”], icon: https://g.blfrp.cn/https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/CN.png}
  - {name: Apple å›½é™…æœåŠ¡, type: select, proxies: [DIRECT,å›½é™…äº’è”], icon: https://g.blfrp.cn/https://raw.githubusercontent.com/shindgewongxj/WHATSINStash/main/icon/apple.png}
  - {name: æ¼ç½‘ä¹‹é±¼, <<: *Group_All, icon: https://g.blfrp.cn/https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Final.png }

  #åˆ†éš”,ä¸‹é¢æ˜¯åœ°åŒºåˆ†ç»„
  - {name: AutoHK, <<: *filterHK, icon: https://g.blfrp.cn/https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Hong_Kong.png}
  - {name: AutoTW, <<: *filterTW, icon: https://g.blfrp.cn/https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Taiwan.png}
  - {name: AutoJP, <<: *filterJP, icon: https://g.blfrp.cn/https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Japan.png}
  - {name: AutoUS, <<: *filterUS, icon: https://g.blfrp.cn/https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/United_States.png}
  - {name: AutoSG, <<: *filterSG, tolerance: 10, icon: https://g.blfrp.cn/https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Singapore.png}
  - {name: AutoNL, <<: *filterNL, icon: https://flagcdn.com/w160/nl.png}
  - {name: AutoLow, <<: *filterLow, icon: https://g.blfrp.cn/https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Area.png}
rules:
  - SUB-RULE,(OR,((NETWORK,UDP),(NETWORK,TCP))),SUB-DOMAIN
  - RULE-SET,Ads,å¹¿å‘Šæ‹¦æˆª
  - RULE-SET,PCDN,REJECT
  - RULE-SET,LAN,DIRECT
  - RULE-SET,Applications,DIRECT
  - RULE-SET,Tracker,DIRECT
  - RULE-SET,Apple_cn,å›½å†…ç›´è¿ # äº‘ä¸Šè´µå·
  - RULE-SET,Apple_cdn,å›½å†…ç›´è¿ # felixonmars/dnsmasq-china-list
  - RULE-SET,Apple,Apple å›½é™…æœåŠ¡ # NoChina
  - RULE-SET,Microsoft,å›½å†…ç›´è¿
  - RULE-SET,China,å›½å†…ç›´è¿
  - RULE-SET,Pikpak,Pikpak
  - RULE-SET,GitHub,GitHub
  - RULE-SET,Google,Google
  - RULE-SET,Google_cn,Google
  - RULE-SET,YouTube,YouTube
  - RULE-SET,Twitter,Twitter
  - RULE-SET,AI,AI Chat
  - RULE-SET,Cdn_domainset,é™æ€ CDN # æ”¾åœ¨é‡è¦è´¦æˆ·ä¸‹é¢ï¼Œé˜²æ­¢é‰´æƒå¯¼è‡´çš„é£æ§
  - RULE-SET,Cdn_non_ip,é™æ€ CDN
  - RULE-SET,Telegram,Telegram,no-resolve
  - RULE-SET,NSFW,Mickey
  - RULE-SET,GFW,å›½é™…äº’è” # å…ˆç”¨ GFWåˆ—è¡¨ è¿‡æ»¤ä¸€éä¸‹é¢çš„ CDN
  - RULE-SET,Cloudflare,Cloudflare å®˜ç½‘
  ### ä¸‹é¢å‘èµ· DNS
  - RULE-SET,Cloudflare_ip,Cloudflare CDN
  - RULE-SET,CloudFront_ip,AWS CDN
  - RULE-SET,Akamai_ip,Akamai CDN
  - RULE-SET,fastly_ip,Fastly CDN
  
  - RULE-SET,China_ip,å›½å†…ç›´è¿
  ###
  - RULE-SET,Global,å›½é™…äº’è” # æ¼ç½‘ä¹‹é±¼èµ°ä»£ç†å¯ä»¥å»æ‰
  - MATCH,æ¼ç½‘ä¹‹é±¼

sub-rules:
  SUB-DOMAIN:
    - AND,((NETWORK,UDP),(DST-PORT,443),(RULE-SET,YouTube)),REJECT-DROP # å±è”½YouTube quic
    - AND,((NETWORK,UDP),(DOMAIN-REGEX,(?i)stun|turn)),REJECT-DROP # WebRTCä¼ è¾“
    - AND,((DOMAIN-KEYWORD,bili),(DOMAIN-REGEX,(?i)pcdn|mcdn)),REJECT
    - AND,((DOMAIN-KEYWORD,jav),(NOT,((DOMAIN-KEYWORD,java)))),å›½é™…äº’è”
    - OR,((DOMAIN-SUFFIX,akamai.net),(DOMAIN-SUFFIX,akamaized.net)),Akamai CDN
    - OR,((DOMAIN-KEYWORD,fuliba),(DOMAIN-KEYWORD,wnflb)),å›½é™…äº’è”
    - OR,((DOMAIN-KEYWORD,zgocloud),(DOMAIN-KEYWORD,zgovps)),å›½å†…ç›´è¿
    - DOMAIN-KEYWORD,porn,å›½é™…äº’è”
    - DOMAIN-KEYWORD,fc2,å›½é™…äº’è”
    - DOMAIN,mcs.zijieapi.com,DIRECT # æ—¥å¿—ä¸ŠæŠ¥ï¼Œè¯·æ±‚é£æš´
    - DOMAIN-SUFFIX,imagestwist.com,å›½é™…äº’è”
    - DOMAIN-SUFFIX,geo2.adobe.com,REJECT-DROP
    - DOMAIN-SUFFIX,in.applicationinsights.azure.com,REJECT-DROP
    - DOMAIN-SUFFIX,pc528.net,å›½å†…ç›´è¿
    - DOMAIN-SUFFIX,liangxin.xyz,å›½é™…äº’è”
    - DOMAIN-SUFFIX,gitbook.io,å›½é™…äº’è”
    - DOMAIN-SUFFIX,51cg1.com,å›½é™…äº’è”
    - DOMAIN-SUFFIX,355.fun,å›½é™…äº’è”
    - DOMAIN-SUFFIX,cloudflare-dns.com,å›½é™…äº’è”
    - DOMAIN-SUFFIX,tgstat.com,å›½é™…äº’è”
    - DOMAIN,dns.cloudflare.com,å›½é™…äº’è”
    - DOMAIN-SUFFIX,cloudflare-gateway.com,å›½å†…ç›´è¿
    - DOMAIN-SUFFIX,ipchaxun.net,DIRECT   # ip138
    
    
rule-providers: # https://clash.wiki/premium/rule-providers.html

  China: {<<: *classic, url: https://g.blfrp.cn/https://raw.githubusercontent.com/LM-Firefly/Rules/master/Clash-RuleSet-Classical/Domestic.yaml}
  China_ip: {<<: *ip, format: text, url: https://g.blfrp.cn/https://raw.githubusercontent.com/Sereinfy/Clash/main/rules/china_ip.txt}
  Apple: {<<: *classic, url: https://g.blfrp.cn/https://raw.githubusercontent.com/LM-Firefly/Rules/master/Clash-RuleSet-Classical/Apple.yaml}
  Apple_cn: {<<: *classic, format: text, url: https://ruleset.skk.moe/Clash/non_ip/apple_cn.txt}
  Apple_cdn: {<<: *domain, url: https://g.blfrp.cn/https://raw.githubusercontent.com/Loyalsoldier/clash-rules/release/apple.txt}
  Microsoft: {<<: *classic, url: https://g.blfrp.cn/https://raw.githubusercontent.com/LM-Firefly/Rules/master/Clash-RuleSet-Classical/Microsoft.yaml}
  LAN: {<<: *classic, url: https://g.blfrp.cn/https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Lan/Lan_No_Resolve.yaml}
  
  Google_cn: {<<: *domain, url: https://g.blfrp.cn/https://raw.githubusercontent.com/DustinWin/ruleset_geodata/mihomo-ruleset/google-cn.yaml}
  
  Applications: {<<: *classic, url: https://g.blfrp.cn/https://raw.githubusercontent.com/DustinWin/ruleset_geodata/mihomo-ruleset/applications.yaml}

  YouTube: {<<: *domain, url: https://g.blfrp.cn/https://raw.githubusercontent.com/DustinWin/ruleset_geodata/mihomo-ruleset/youtube.yaml}
  Google: {<<: *classic, url: https://g.blfrp.cn/https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Google/Google_No_Resolve.yaml}
  GitHub: {<<: *classic, url: https://g.blfrp.cn/https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/GitHub/GitHub_No_Resolve.yaml}
  Twitter: {<<: *classic, url: https://g.blfrp.cn/https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Twitter/Twitter_No_Resolve.yaml}
  Pikpak: {<<: *classic, url: https://g.blfrp.cn/https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/PikPak/PikPak_No_Resolve.yaml}
  Cloudflare: {<<: *classic, url: https://g.blfrp.cn/https://raw.githubusercontent.com/LM-Firefly/Rules/master/Clash-RuleSet-Classical/PROXY/Cloudflare.yaml}
  AI: {<<: *domain, url: https://g.blfrp.cn/https://raw.githubusercontent.com/DustinWin/ruleset_geodata/mihomo-ruleset/ai.yaml}
  Telegram: {<<: *ip, url: https://g.blfrp.cn/https://raw.githubusercontent.com/Loyalsoldier/clash-rules/release/telegramcidr.txt}
  
  NSFW: {<<: *domain, url: https://g.blfrp.cn/https://raw.githubusercontent.com/Sereinfy/Clash/main/rules/oisd_nsfw_small.yaml}
  GFW: {<<: *domain, url: https://g.blfrp.cn/https://raw.githubusercontent.com/Loyalsoldier/clash-rules/release/gfw.txt}
  Global: {<<: *domain, url: https://g.blfrp.cn/https://raw.githubusercontent.com/DustinWin/ruleset_geodata/mihomo-ruleset/proxy.yaml}

  Ads: {<<: *domain, url: https://g.blfrp.cn/https://raw.githubusercontent.com/Sereinfy/Adrules/main/rules/adblockmihomolite.yaml}
  Tracker: {<<: *classic, url: https://g.blfrp.cn/https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/PrivateTracker/PrivateTracker_No_Resolve.yaml}
  fakeip-filter: {<<: *domain, url: https://g.blfrp.cn/https://raw.githubusercontent.com/DustinWin/ruleset_geodata/mihomo-ruleset/fakeip-filter.yaml}
  PCDN: {<<: *classic, format: text, url: https://g.blfrp.cn/https://raw.githubusercontent.com/uselibrary/PCDN/main/pcdn.list}
  Cdn_domainset: {<<: *domain, format: text, url: https://ruleset.skk.moe/Clash/domainset/cdn.txt}
  Cdn_non_ip: {<<: *classic, format: text, url: https://ruleset.skk.moe/Clash/non_ip/cdn.txt}
  Cloudflare_ip: {<<: *ip, format: text, url: https://g.blfrp.cn/https://raw.githubusercontent.com/sbwml/luci-app-mosdns/v5/luci-app-mosdns/root/etc/mosdns/rule/cloudflare-cidr.txt}
  CloudFront_ip: {<<: *ip, format: text, url: https://g.blfrp.cn/https://raw.githubusercontent.com/Sereinfy/ipranges/main/amazon/cloudfront_ips.txt}
  Akamai_ip: {<<: *ip, format: text, url: https://g.blfrp.cn/https://raw.githubusercontent.com/Sereinfy/ipranges/main/akamai/ipv4_merged.txt}
  fastly_ip: {<<: *ip, url: https://g.blfrp.cn/https://raw.githubusercontent.com/Loyalsoldier/geoip/release/clash/ipcidr/fastly.txt}
