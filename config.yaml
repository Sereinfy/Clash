port: 7890
socks-port: 7891
# Transparent proxy server port for Linux and macOS
# redir-port: 7892
mixed-port: 7890
allow-lan: false

mode: Rule
ipv6: true
log-level: info
unified-delay: true
tcp-concurrent: true

external-controller: 127.0.0.1:9090
external-ui-url: https://g.blfrp.cn/https://github.com/Zephyruso/zashboard/releases/latest/download/dist.zip
external-ui: ui
external-ui-name: zashboard

geodata-mode: false
geo-auto-update: true
geo-update-interval: 24
geox-url:
  geoip: https://g.blfrp.cn/https://github.com/DustinWin/ruleset_geodata/releases/download/mihomo/geoip.dat
  geosite: https://g.blfrp.cn/https://github.com/DustinWin/ruleset_geodata/releases/download/mihomo/geosite.dat
  mmdb: https://g.blfrp.cn/https://github.com/DustinWin/ruleset_geodata/releases/download/mihomo/Country.mmdb
  asn: https://g.blfrp.cn/https://github.com/DustinWin/ruleset_geodata/releases/download/mihomo/Country-ASN.mmdb
  
find-process-mode: strict
global-client-fingerprint: chrome

profile:
  store-selected: true
  store-fake-ip: true
  
dns:
  enable: true
  listen: 0.0.0.0:1053
  ipv6: true
  enhanced-mode: fake-ip #redir-host
  fake-ip-range: 198.18.0.1/16
  fake-ip-filter:
    - rule-set:fakeip-filter   
  nameserver:
    - https://doh.pub/dns-query
    - https://dns.alidns.com/dns-query
#  fallback:
#    - https://v.recipes/dns/dns.google/dns-query
#    - https://v.recipes/dns/dns.cloudflare.com/dns-query
  proxy-server-nameserver:
    - https://doh.pub/dns-query
  nameserver-policy:
    '+.pc528.net': '223.5.5.5'
tun:
  enable: true  # enable 'true'
  stack: system  # or 'gvisor'
  auto-route: true
  auto-redirect: true
  auto-detect-interface: true
  dns-hijack:
    - "any:53"

sniffer:
  enable: false
  force-dns-mapping: true
  parse-pure-ip: true
  override-destination: false
  sniff:
    HTTP:
      ports: [80, 8080-8880]
      override-destination: true
    TLS:
      ports: [443, 8443]
    QUIC:
      ports: [443, 8443]
       
listeners:
- name: socks-in
  type: socks
  port: 10808
  proxy: Airport

proxies:


  # é”šç‚¹å¼•ç”¨
rule-anchor:
  # è‡ªåŠ¨æµ‹é€Ÿ
  TestUrl: &TestUrl {url: "http://www.gstatic.com/generate_204", interval: 300}
  AutoAll: &AutoAll {type: url-test, include-all: true, timeout: 3000, max-failed-times: 2, hidden: true, tolerance: 50, <<: *TestUrl}
  # å¥åº·æ£€æŸ¥
  Check: &Check {type: http, interval: 3600, health-check: {enable: true, <<: *TestUrl}}
  # è¿œç¨‹å‚æ•°
  Classical: &classic {type: http, interval: 86400, behavior: classical}
  ipcidr: &ip {type: http, interval: 86400, behavior: ipcidr}
  domain: &domain {type: http, interval: 86400, behavior: domain}
  # Globally
  selectvps: &selectvps {type: select, <<: *TestUrl, use: [Build], include-all-proxies: true, proxies: [DIRECT,Airport]}
  # Airport
  selectCity: &selectCity {type: select, <<: *TestUrl, include-all-providers: true, proxies: [AutoHK,AutoTW,AutoJP,AutoSG,AutoUS]}
  selectAll: &selectAll {type: select, proxies: [Globally,AutoHK,AutoTW,AutoJP,AutoSG,AutoUS,AutoLow,DIRECT]}
  selectCDN: &selectCDN {type: select, proxies: [DIRECT,Globally,AutoHK,AutoTW,AutoJP,AutoSG,AutoUS,AutoLow]}
  selectGH: &selectGH {type: select, use: [Build], include-all-proxies: true, proxies: [Globally,AutoUS,DIRECT]}
  TG_EU_PASS: &TG_EU_PASS {type: select, proxies: [Globally,Airport,AutoNL,AutoUS]}
  # èŠ‚ç‚¹è¿‡æ»¤
  Exclude: &Exclude {exclude-filter: å¥ˆé£ž|æŽ¨è|è¿‡æœŸ|å‰©ä½™|åˆ°æœŸ|å®˜ç½‘|å¤±è”|å›žå›½|ç¾¤|é•¿æœŸ|é‡ç½®|ä½™é¢|å……å€¼|æ°ªé‡‘|å¥—é¤|é™åˆ¶}
  type: &type {exclude-type: hysteria2}
  # åœ°åŒºè¿‡æ»¤
  filterHK: &filterHK {<<: *AutoAll, filter: "(?i)(?!ç›´è¿ž)(é¦™æ¸¯|ðŸ‡­ðŸ‡°|hk|hongkong|hong kong|HKG)"}
  filterTW: &filterTW {<<: *AutoAll, filter: "(?i)(?!ç›´è¿ž)(å°æ¹¾|ðŸ‡¼ðŸ‡¸|ðŸ‡¹ðŸ‡¼|TW|taiwan|TPE|TSA|KHH)"}
  filterJP: &filterJP {<<: *AutoAll, filter: "(?i)(?!ç›´è¿ž)(æ—¥æœ¬|ä¸œäº¬|ðŸ‡¯ðŸ‡µ|JP|Japan|NRT|HND|KIX|CTS|FUK)"}
  filterUS: &filterUS {<<: *AutoAll, filter: "(?i)(?!ç›´è¿ž)(ç¾Žå›½|ðŸ‡ºðŸ‡¸|æ´›æ‰çŸ¶|åœ£ä½•å¡ž|çº½çº¦|å‡¤å‡°åŸŽ|us|unitedstates|united states)"}
  filterSG: &filterSG {<<: *AutoAll, filter: "(?i)(?!ç›´è¿ž)(æ–°åŠ å¡|ðŸ‡¸ðŸ‡¬|sg|singapore)"}
  filterNL: &filterNL {<<: *AutoAll, filter: "(?i)(?!ç›´è¿ž)(è·å…°|ðŸ‡³ðŸ‡±|nl|Netherlands)"}
  filterLow: &filterLow {<<: *AutoAll, filter: "(?i)(?!ç›´è¿ž)(0.[1-8])"}

proxy-providers:
  # æ²¡æœ‰è‡ªå»ºä¸ç”¨å¡«
  Build:
    <<: [*Check,*Exclude]
    url: ""

  # æœºåœºè®¢é˜…
  æŸæŸäº‘:
    <<: [*Check,*Exclude]
#    filter: é¦™æ¸¯|æ–°åŠ å¡
    url: ""  # åœ¨å¼•å·é‡Œå¡«ä½ çš„è®¢é˜…é“¾æŽ¥
    override:
      additional-prefix: "[æŸæŸäº‘]"
      
proxy-groups:
  - {name: Globally, <<: *selectvps, icon: https://g.blfrp.cn/https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Proxy.png}
  - {name: Airport, <<: *selectCity, icon: https://g.blfrp.cn/https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Airport.png}
  - {name: Domestic, type: select, hidden: true, proxies: [DIRECT,Globally], icon: https://g.blfrp.cn/https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/China.png}
  - {name: Twitter, <<: *selectAll, icon: https://g.blfrp.cn/https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Twitter.png}
  #- {name: TG_EU, <<: *TG_EU_PASS, icon: https://g.blfrp.cn/https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Telegram_X.png}
  - {name: Google, <<: *selectAll, icon: https://g.blfrp.cn/https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Google_Search.png}
  - {name: Apple services, type: select, proxies: [DIRECT,Globally], icon: https://g.blfrp.cn/https://raw.githubusercontent.com/shindgewongxj/WHATSINStash/main/icon/apple.png}
  - {name: YouTube, <<: *selectAll, icon: https://g.blfrp.cn/https://raw.githubusercontent.com/Sereinfy/Clash/main/icons/YouTube2.png}
  - {name: GitHub, <<: *selectGH, icon: https://g.blfrp.cn/https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/GitHub.png} 
  - {name: AI, <<: *selectAll, icon: https://g.blfrp.cn/https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Bot.png}
  
  - {name: Pikpak, <<: *selectAll, hidden: true, icon: https://g.blfrp.cn/https://raw.githubusercontent.com/fmz200/wool_scripts/main/icons/softlyx/PikPak.png}
  - {name: Static CDN, <<: *selectAll, icon: https://g.blfrp.cn/https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Global.png}
  - {name: Telegram, <<: *selectAll, icon: https://g.blfrp.cn/https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Telegram.png}

  - {name: Mickey, <<: *selectAll, icon: https://g.blfrp.cn/https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Mickey.png}
  
  - {name: Cloudflare,<<: *selectCDN, icon: https://g.blfrp.cn/https://raw.githubusercontent.com/Sereinfy/Clash/main/icons/1111.png}
  - {name: Cloudflare CDN,<<: *selectCDN, icon: https://g.blfrp.cn/https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Cloudflare.png}
  - {name: AWS CDN,<<: *selectCDN, icon: https://g.blfrp.cn/https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Amazon.png}
  - {name: Akamai CDN, <<: *selectCDN, icon: https://g.blfrp.cn/https://raw.githubusercontent.com/Sereinfy/Clash/main/icons/akamai.png}
  - {name: Fastly CDN, <<: *selectCDN, icon: https://g.blfrp.cn/https://raw.githubusercontent.com/Sereinfy/Clash/main/icons/fastly3.png}
  - {name: Missed, <<: *selectAll, icon: https://g.blfrp.cn/https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Final.png }
  - {name: Ads, type: select, proxies: [REJECT,DIRECT], icon: https://g.blfrp.cn/https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Reject.png}

  #åˆ†éš”,ä¸‹é¢æ˜¯åœ°åŒºåˆ†ç»„ 
  - {name: AutoHK, <<: *filterHK, icon: https://g.blfrp.cn/https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Hong_Kong.png}
  - {name: AutoTW, <<: *filterTW, icon: https://g.blfrp.cn/https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Taiwan.png}
  - {name: AutoJP, <<: *filterJP, icon: https://g.blfrp.cn/https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Japan.png}
  - {name: AutoUS, <<: *filterUS, icon: https://g.blfrp.cn/https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/United_States.png}
  - {name: AutoSG, <<: *filterSG, icon: https://g.blfrp.cn/https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Singapore.png}
  - {name: AutoNL, <<: *filterNL, icon: https://flagcdn.com/w160/nl.png}
  - {name: AutoLow, <<: *filterLow, icon: https://g.blfrp.cn/https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Area.png}
rules:

  - SUB-RULE,(OR,((NETWORK,UDP),(NETWORK,TCP))),SUB-DOMAIN
  - RULE-SET,Adblock,Ads
  - RULE-SET,PCDN,REJECT
  - RULE-SET,LAN,DIRECT
  - RULE-SET,Applications,DIRECT
  - RULE-SET,Tracker,DIRECT
  - RULE-SET,Apple_cn,Domestic # äº‘ä¸Šè´µå·ž
  - RULE-SET,Apple_cdn,Domestic # felixonmars/dnsmasq-china-list
  - RULE-SET,Apple,Apple services # NoChina
  - RULE-SET,Microsoft,Domestic
  - RULE-SET,China,Domestic
  - RULE-SET,Pikpak,Pikpak
  - RULE-SET,GitHub,GitHub
  - RULE-SET,Google,Google
  - RULE-SET,Google_cn,Google
  - RULE-SET,YouTube,YouTube
  - RULE-SET,Twitter,Twitter
  - RULE-SET,AI,AI
  - RULE-SET,Cdn_domainset,Static CDN # æ”¾åœ¨é‡è¦è´¦æˆ·ä¸‹é¢ï¼Œé˜²æ­¢é‰´æƒå¯¼è‡´çš„é£ŽæŽ§
  - RULE-SET,Cdn_non_ip,Static CDN
  - RULE-SET,Telegram,Telegram,no-resolve
  - RULE-SET,Global,Globally
  
  - RULE-SET,Cloudflare,Cloudflare
  ### ä¸‹é¢å‘èµ· DNS
  - RULE-SET,Cloudflare_ip,Cloudflare CDN
  - RULE-SET,CloudFront_ip,AWS CDN
  - RULE-SET,Akamai_ip,Akamai CDN
  - RULE-SET,fastly_ip,Fastly CDN
  
  - RULE-SET,China_ip,Domestic
  ###
  - MATCH,Missed

sub-rules:
  SUB-DOMAIN:
    - AND,((DST-PORT,443),(NETWORK,UDP),(NOT,((OR,(RULE-SET,China),(RULE-SET,China_ip,no-resolve))))),REJECT-DROP # å±è”½å›½å¤–quic    
#    - AND,((NETWORK,UDP),(DST-PORT,443),(RULE-SET,YouTube)),REJECT-DROP # å±è”½YouTube quic
    - AND,((NETWORK,UDP),(DOMAIN-REGEX,(?i)stun|turn)),REJECT-DROP # WebRTCä¼ è¾“
    - AND,((DOMAIN-KEYWORD,bili),(DOMAIN-REGEX,(?i)pcdn|mcdn)),REJECT
    - OR,((DOMAIN-SUFFIX,akamai.net),(DOMAIN-SUFFIX,akamaized.net)),Akamai CDN
    - OR,((DOMAIN-KEYWORD,zgocloud),(DOMAIN-KEYWORD,zgovps)),Domestic
    - DOMAIN,mcs.zijieapi.com,DIRECT # æ—¥å¿—ä¸ŠæŠ¥ï¼Œè¯·æ±‚é£Žæš´
    - DOMAIN-SUFFIX,imagestwist.com,Globally
    - DOMAIN-SUFFIX,geo2.adobe.com,REJECT-DROP
    - DOMAIN-SUFFIX,in.applicationinsights.azure.com,REJECT-DROP
    - DOMAIN-SUFFIX,pc528.net,Domestic
    - DOMAIN-SUFFIX,liangxin.xyz,Globally
    - DOMAIN-SUFFIX,gitbook.io,Globally
    - DOMAIN-SUFFIX,ipchaxun.net,DIRECT   # ip138
    
    
rule-providers: # https://clash.wiki/premium/rule-providers.html

  China: {<<: *classic, url: https://g.blfrp.cn/https://raw.githubusercontent.com/LM-Firefly/Rules/master/Clash-RuleSet-Classical/Domestic.yaml}
  China_ip: {<<: *ip, format: text, url: https://g.blfrp.cn/https://raw.githubusercontent.com/Sereinfy/Clash/main/rules/china_ip.txt}
  Apple: {<<: *classic, url: https://g.blfrp.cn/https://raw.githubusercontent.com/LM-Firefly/Rules/master/Clash-RuleSet-Classical/Apple.yaml}
  Apple_cn: {<<: *classic, format: text, url: https://ruleset.skk.moe/Clash/non_ip/apple_cn.txt}
  Apple_cdn: {<<: *domain, url: https://g.blfrp.cn/https://raw.githubusercontent.com/Loyalsoldier/clash-rules/release/apple.txt}
  Microsoft: {<<: *classic, url: https://g.blfrp.cn/https://raw.githubusercontent.com/LM-Firefly/Rules/master/Clash-RuleSet-Classical/Microsoft.yaml}
  LAN: {<<: *classic, url: https://g.blfrp.cn/https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Lan/Lan_No_Resolve.yaml}
  
  Google_cn: {<<: *domain, url: https://g.blfrp.cn/https://raw.githubusercontent.com/DustinWin/ruleset_geodata/mihomo-ruleset/google-cn.yaml}
  
  Applications: {<<: *classic, url: https://g.blfrp.cn/https://raw.githubusercontent.com/DustinWin/ruleset_geodata/mihomo-ruleset/applications.yaml}

  YouTube: {<<: *domain, url: https://g.blfrp.cn/https://raw.githubusercontent.com/DustinWin/ruleset_geodata/mihomo-ruleset/youtube.yaml}
  Google: {<<: *classic, url: https://g.blfrp.cn/https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Google/Google_No_Resolve.yaml}
  GitHub: {<<: *classic, url: https://g.blfrp.cn/https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/GitHub/GitHub_No_Resolve.yaml}
  Twitter: {<<: *classic, url: https://g.blfrp.cn/https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Twitter/Twitter_No_Resolve.yaml}
  Pikpak: {<<: *classic, url: https://g.blfrp.cn/https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/PikPak/PikPak_No_Resolve.yaml}
  Cloudflare: {<<: *classic, url: https://g.blfrp.cn/https://raw.githubusercontent.com/LM-Firefly/Rules/master/Clash-RuleSet-Classical/PROXY/Cloudflare.yaml}
  AI: {<<: *domain, url: https://g.blfrp.cn/https://raw.githubusercontent.com/DustinWin/ruleset_geodata/mihomo-ruleset/ai.yaml}
  Telegram: {<<: *ip, url: https://g.blfrp.cn/https://raw.githubusercontent.com/Loyalsoldier/clash-rules/release/telegramcidr.txt}
  
  Global: {<<: *domain, url: https://g.blfrp.cn/https://raw.githubusercontent.com/DustinWin/ruleset_geodata/mihomo-ruleset/proxy.yaml}

  Adblock: {<<: *domain, url: https://g.blfrp.cn/https://raw.githubusercontent.com/217heidai/adblockfilters/main/rules/adblockmihomolite.yaml}
  Tracker: {<<: *classic, url: https://g.blfrp.cn/https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/PrivateTracker/PrivateTracker_No_Resolve.yaml}
  fakeip-filter: {<<: *domain, url: https://g.blfrp.cn/https://raw.githubusercontent.com/DustinWin/ruleset_geodata/mihomo-ruleset/fakeip-filter.yaml}
  PCDN: {<<: *classic, format: text, url: https://g.blfrp.cn/https://raw.githubusercontent.com/uselibrary/PCDN/main/pcdn.list}
  Cdn_domainset: {<<: *domain, format: text, url: https://ruleset.skk.moe/Clash/domainset/cdn.txt}
  Cdn_non_ip: {<<: *classic, format: text, url: https://ruleset.skk.moe/Clash/non_ip/cdn.txt}
  Cloudflare_ip: {<<: *ip, format: text, url: https://g.blfrp.cn/https://raw.githubusercontent.com/sbwml/luci-app-mosdns/v5/luci-app-mosdns/root/etc/mosdns/rule/cloudflare-cidr.txt}
  CloudFront_ip: {<<: *ip, format: text, url: https://g.blfrp.cn/https://raw.githubusercontent.com/Sereinfy/ipranges/main/amazon/cloudfront_ips.txt}
  Akamai_ip: {<<: *ip, format: text, url: https://g.blfrp.cn/https://raw.githubusercontent.com/Sereinfy/ipranges/main/akamai/ipv4_merged.txt}
  fastly_ip: {<<: *ip, url: https://g.blfrp.cn/https://raw.githubusercontent.com/Loyalsoldier/geoip/release/clash/ipcidr/fastly.txt}
