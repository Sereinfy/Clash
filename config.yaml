port: 7890
socks-port: 7891

# Transparent proxy server port for Linux and macOS
# redir-port: 7892

mixed-port: 7890
allow-lan: false

mode: Rule
ipv6: false
log-level: info
unified-delay: true
tcp-concurrent: true

external-controller: :9090
external-ui-url: https://github.com/Zephyruso/zashboard/releases/latest/download/dist.zip
external-ui: ui
external-ui-name: zashboard

geodata-mode: false
geo-auto-update: true
geo-update-interval: 24
geox-url:
  geoip: https://ghp.ci/https://github.com/Sereinfy/ruleset_geodata/releases/download/clash/geoip.dat
  geosite: https://ghp.ci/https://github.com/Sereinfy/ruleset_geodata/releases/download/clash/geosite.dat
  mmdb: https://ghp.ci/https://github.com/Sereinfy/ruleset_geodata/releases/download/clash/Country.mmdb
  asn: https://ghp.ci/https://github.com/Sereinfy/ruleset_geodata/releases/download/clash/Country-ASN.mmdb
  
find-process-mode: strict
global-client-fingerprint: chrome

profile:
  store-selected: true
  store-fake-ip: true
  
dns:
  enable: true
  listen: 0.0.0.0:53
  ipv6: false
  enhanced-mode: fake-ip #redir-host
  fake-ip-range: 198.18.0.1/16
  fake-ip-filter:
    - rule-set:fakeip-filter   
  default-nameserver:
    - 223.5.5.5
    - 119.29.29.29
  nameserver:
    - https://doh.pub/dns-query#proxy
    - https://dns.alidns.com/dns-query
  fallback:
    - https://1.1.1.1/dns-query
    - https://185.222.222.222/dns-query
  proxy-server-nameserver:
    - tls://101.101.101.101
  nameserver-policy:
    '+.makima.online': '223.5.5.5'
tun:
  enable: true  # enable 'true'
  stack: system  # or 'gvisor'
  dns-hijack:
    - "any:53"
  auto-route: true
  auto-redirect: true
  auto-detect-interface: true

sniffer:
  enable: false
  sniff:
    TLS:
      ports: [443, 8443]
    HTTP:
      ports: [80, 8080-8880]
      override-destination: true
       
listeners:
- name: socks-in
  type: socks
  port: 10808
  proxy: 机场选择
    
proxies:


# 锚点引用
rule-anchor:
  # 自动测速
  testUrl: &testUrl {url: "http://www.gstatic.com/generate_204", interval: 300}
  autoAll: &autoAll {type: url-test, include-all: true, hidden: false, <<: *testUrl}
  # 健康检查
  Check: &Check {type: http, interval: 3600, health-check: {enable: true, <<: *testUrl}}
  # 远程参数
  Classical: &classic {type: http, interval: 86400, behavior: classical}
  ipcidr: &ip {type: http, interval: 86400, behavior: ipcidr}
  domain: &domain {type: http, interval: 86400, behavior: domain, format: mrs}
  # 手动选择
  selectvps: &selectvps {type: select, <<: *testUrl, use: [MyVps], include-all-proxies: true, proxies: [机场选择,DIRECT]}
  # 机场选择
  selectCity: &selectCity {type: select, <<: *testUrl, include-all-providers: true, proxies: [香港自动,台湾自动,日本自动,新加坡自动,美国自动,欧盟自动]}
  selectAll: &selectAll {type: select, include-all-providers: true, proxies: [手动选择,香港自动,台湾自动,日本自动,新加坡自动,美国自动,欧盟自动,DIRECT,PASS]}
  # 节点过滤
  Exclude: &Exclude {exclude-filter: 奈飞|推荐|过期|剩余|到期|官网|失联|回国|群|长期|重置|余额|充值|氪金|套餐|限制}
  # 地区过滤
  filterHK: &filterHK {<<: *autoAll, filter: "(?i)(?!直连)(香港|🇭🇰|hk|hongkong|hong kong|HKG)"}
  filterTW: &filterTW {<<: *autoAll, filter: "(?i)(?!直连)(台湾|🇼🇸|🇹🇼|TW|taiwan|TPE|TSA|KHH)"}
  filterJP: &filterJP {<<: *autoAll, filter: "(?i)(?!直连)(日本|东京|🇯🇵|JP|Japan|NRT|HND|KIX|CTS|FUK)"}
  filterUS: &filterUS {<<: *autoAll, filter: "(?i)(?!直连)(美国|🇺🇸|洛杉矶|圣何塞|纽约|凤凰城|us|unitedstates|united states)"}
  filterSG: &filterSG {<<: *autoAll, filter: "(?i)(?!直连)(新加坡|🇸🇬|sg|singapore)"}
  filterNL: &filterNL {<<: *autoAll, filter: "(?i)(?!直连)(荷兰|🇳🇱|nl|Netherlands)"}
  FilterEU: &FilterEU {<<: *autoAll, filter: "(?i)(?!直连)(欧盟|奥地利|比利时|保加利亚|克罗地亚|塞浦路斯|捷克共和国|丹麦|爱沙尼亚|芬兰|法国|德国|希腊|匈牙利|爱尔兰|意大利|拉脱维亚|立陶宛|卢森堡|马耳他|荷兰|波兰|葡萄牙|罗马尼亚|斯洛伐克|斯洛文尼亚|西班牙|瑞典|Austria|Belgium|Bulgaria|Croatia|Cyprus|Czech Republic|Denmark|Estonia|Finland|France|Germany|Greece|Hungary|Ireland|Italy|Latvia|Lithuania|Luxembourg|Malta|Netherlands|Poland|Portugal|Romania|Slovakia|Slovenia|Spain|Sweden|🇧🇪|🇨🇿|🇩🇰|🇫🇮|🇫🇷|🇩🇪|🇮🇪|🇮🇹|🇱🇹|🇱🇺|🇳🇱|🇵🇱|🇸🇪|🇬🇧|CDG|FRA|AMS|MAD|BCN|FCO|MUC|BRU)"}
proxy-providers:
  # 没有自建不用填
  MyVps: {<<: [*Check,*Exclude], url: ""} 
  
  # 机场订阅
  name:
    <<: [*Check,*Exclude]
#    filter: 香港|新加坡
    url: "https://bujidao.cc/sub?key=kdzvR3zKR05oVO7yT55y8IsSngwJyOoC"
    override:
      additional-prefix: "[]"

  
proxy-groups:
  - {name: 手动选择, <<: *selectvps, icon: https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Proxy.png}
  - {name: 机场选择, <<: *selectCity, icon: https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Airport.png}
  - {name: Twitter, <<: *selectAll, icon: https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Twitter.png}
  - {name: Telegram, <<: *selectAll, icon: https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Telegram.png}
  - {name: TG欧盟, type: select, proxies: [欧盟自动,荷兰自动], icon: https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Telegram_X.png}
  - {name: Google, <<: *selectAll, icon: https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Google_Search.png}
  - {name: AI, <<: *selectAll, icon: https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Bot.png}
  - {name: YouTube, <<: *selectAll, icon: https://raw.githubusercontent.com/Sereinfy/clash/main/icons/YouTube2.png}
  - {name: AppleProxy,<<: *selectAll, icon: https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Apple_2.png}
  - {name: CloudflareIP,<<: *selectAll, icon: https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Cloudflare.png}
  - {name: 漏网之鱼, <<: *selectAll, icon: https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Final.png }
  - {name: Akamai, <<: *selectAll, icon: https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Azure.png}
  - {name: Pikpak, <<: *selectAll, icon: https://raw.githubusercontent.com/Sereinfy/clash/main/icons/Pikpakre.png}
  - {name: 全球互联, <<: *selectAll, icon: https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Global.png}
  - {name: 国内直连, type: select, proxies: [DIRECT,手动选择], icon: https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/China.png}
  - {name: 广告拦截, type: select, proxies: [REJECT,DIRECT], icon: https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Reject.png}

  #分隔,下面是地区分组
  - {name: 香港自动, <<: *filterHK, icon: "https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Hong_Kong.png"}
  - {name: 台湾自动, <<: *filterTW, icon: "https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Taiwan.png"}
  - {name: 日本自动, <<: *filterJP, icon: "https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Japan.png"}
  - {name: 美国自动, <<: *filterUS, icon: "https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/United_States.png"}
  - {name: 新加坡自动, <<: *filterSG, icon: "https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Singapore.png"}
  - {name: 荷兰自动, <<: *filterNL, icon: "https://raw.githubusercontent.com/Sereinfy/clash/main/icons/Netherlands.png"}
  - {name: 欧盟自动, <<: *FilterEU, icon: "https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/European_Union.png"}
rules:
  - AND,((DST-PORT,443),(NETWORK,UDP),(NOT,((OR,(GEOSITE,cn),(GEOIP,cn,no-resolve))))),REJECT-DROP # 屏蔽国外quic
  - AND,((NETWORK,UDP),(DOMAIN-REGEX,(?i)stun|turn)),REJECT-DROP
  - AND,((DOMAIN-KEYWORD,bili),(DOMAIN-REGEX,(?i)pcdn|mcdn)),REJECT
  - OR,((DOMAIN-SUFFIX,akamai.net),(DOMAIN-SUFFIX,akamaized.net)),Akamai
  - OR,((DOMAIN-KEYWORD,fuliba),(DOMAIN-KEYWORD,wnflb)),手动选择
  - OR,((DOMAIN-KEYWORD,zgocloud),(DOMAIN-KEYWORD,zgovps)),国内直连
  - DOMAIN-SUFFIX,makima.online,国内直连
  - DOMAIN-SUFFIX,imagestwist.com,手动选择
  - DOMAIN-SUFFIX,geo2.adobe.com,REJECT-DROP
  - DOMAIN-SUFFIX,in.applicationinsights.azure.com,REJECT-DROP
  - RULE-SET,pikpak,Pikpak,no-resolve
  - RULE-SET,Adblock,广告拦截,no-resolve
  - RULE-SET,LAN,国内直连,no-resolve
  - RULE-SET,Tracker,国内直连,no-resolve
  - RULE-SET,applications,国内直连,no-resolve
  - RULE-SET,domestic_non_ip,国内直连,no-resolve
  - RULE-SET,Google,Google,no-resolve
  - RULE-SET,Google_cn,Google,no-resolve
  - RULE-SET,YouTube,YouTube,no-resolve
  - RULE-SET,Twitter,Twitter,no-resolve
  - RULE-SET,GitHub,手动选择,no-resolve
  - RULE-SET,AppleProxy,AppleProxy,no-resolve
  - RULE-SET,AI,AI,no-resolve
  - RULE-SET,China,国内直连,no-resolve #Loyalsoldier包含 Microsoft_cn Apple_cn Google_cn
  - RULE-SET,Global,全球互联,no-resolve
  - RULE-SET,Telegram,Telegram,no-resolve
  - RULE-SET,telegram_SG,新加坡自动,no-resolve
  - RULE-SET,telegram_US,美国自动,no-resolve
  - RULE-SET,telegram_EU,TG欧盟,no-resolve
  - RULE-SET,ChinaIP,国内直连
  - RULE-SET,Cloudflare,CloudflareIP
  - MATCH,漏网之鱼

rule-providers: 
  domestic_non_ip: {<<: *classic, format: text, url: https://ruleset.skk.moe/Clash/non_ip/domestic.txt}
  applications: {<<: *classic, url: https://ghfast.top/https://raw.githubusercontent.com/Sereinfy/ruleset_geodata/clash-ruleset/applications.yaml}
  LAN: {<<: *classic, url: https://ghfast.top/https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Lan/Lan.yaml}
  Tracker: {<<: *classic, url: https://ghfast.top/https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/PrivateTracker/PrivateTracker.yaml}
  pikpak: {<<: *classic, format: text, url: https://ghfast.top/https://raw.githubusercontent.com/Sereinfy/clash/refs/heads/main/rules/pikpak.list}
  fakeip-filter: {<<: *domain, url: https://ghfast.top/https://raw.githubusercontent.com/Sereinfy/ruleset_geodata/clash-ruleset/fakeip-filter.mrs}
  Google: {<<: *domain, url: https://ghfast.top/https://raw.githubusercontent.com/Sereinfy/ruleset_geodata/clash-ruleset/google.mrs}
  Google_cn: {<<: *domain, url: https://ghfast.top/https://raw.githubusercontent.com/Sereinfy/ruleset_geodata/clash-ruleset/google-cn.mrs}
  GitHub: {<<: *domain, url: https://ghfast.top/https://raw.githubusercontent.com/Sereinfy/ruleset_geodata/clash-ruleset/github.mrs}
  Twitter: {<<: *domain, url: https://ghfast.top/https://raw.githubusercontent.com/Sereinfy/ruleset_geodata/clash-ruleset/twitter.mrs}
  YouTube: {<<: *domain, url: https://ghfast.top/https://raw.githubusercontent.com/Sereinfy/ruleset_geodata/clash-ruleset/youtube.mrs}
  AI: {<<: *domain, url: https://ghfast.top/https://raw.githubusercontent.com/Sereinfy/ruleset_geodata/clash-ruleset/ai.mrs}
  Global: {<<: *domain, url: https://ghfast.top/https://raw.githubusercontent.com/Sereinfy/ruleset_geodata/clash-ruleset/proxy.mrs}
  AppleProxy: {<<: *domain, url: https://ghfast.top/https://raw.githubusercontent.com/Sereinfy/ruleset_geodata/clash-ruleset/appleProxy.mrs}
  Adblock: {<<: *domain, url: https://ghfast.top/https://raw.githubusercontent.com/Sereinfy/ruleset_geodata/clash-ruleset/ads.mrs}
  China: {<<: *domain, url: https://ghfast.top/https://raw.githubusercontent.com/Sereinfy/ruleset_geodata/clash-ruleset/cn.mrs}
  ChinaIP: {<<: *ip, format: mrs, url: https://ghfast.top/https://raw.githubusercontent.com/Sereinfy/ruleset_geodata/clash-ruleset/cnip.mrs}
  Cloudflare: {<<: *ip, format: mrs, url: https://ghfast.top/https://raw.githubusercontent.com/Sereinfy/ruleset_geodata/clash-ruleset/cloudflareip.mrs}
  Telegram: {<<: *ip, format: mrs, url: https://ghfast.top/https://raw.githubusercontent.com/Sereinfy/ruleset_geodata/clash-ruleset/telegramip.mrs}
  telegram_SG: {<<: *ip, url: https://ghfast.top/https://raw.githubusercontent.com/Sereinfy/clash/main/rules/telegram-SG.yaml}
  telegram_US: {<<: *ip, url: https://ghfast.top/https://raw.githubusercontent.com/Sereinfy/clash/main/rules/telegram-US.yaml}
  telegram_EU: {<<: *ip, url: https://ghfast.top/https://raw.githubusercontent.com/Sereinfy/clash/main/rules/telegram-EU.yaml}
